# badmintonBot
羽球人_LINE BOT

## 專案簡介

badmintonBot 是一個專為羽球團體設計的 LINE Bot，提供活動管理、報名系統、群組設定等功能。透過 Google Apps Script 開發，使用 Google Sheets 作為資料庫，讓羽球團體能夠輕鬆管理活動和報名流程。

## 主要功能

### 🏸 活動管理
- **開團功能**: 支援週期性開團（週一至週日）
- **活動代碼**: 自動產生唯一活動代碼（如 T01、F02）
- **截止時間**: 自動設定報名截止時間
- **人數門檻**: 可設定成團人數門檻

### 📝 報名系統
- **多種報名格式**:
  - `!報名 F01 小明+2 網友` (2人報名)
  - `!報名 F01 小明 晚10分鐘到` (1人報名，省略+1)
  - `!報名 7/14 20-22 小明+2 會晚到` (新格式，直接指定日期時間)
- **修改報名**: `!修改報名 F01 小明+2 備註`
- **取消報名**: `!取消報名 F01 小明-2`
- **查詢報名**: `!查詢報名 F01`

### 👥 群組管理
- **群組設定**: 自訂群組名稱、預設場館、時間範圍
- **管理員權限**: 支援多層級管理員權限
- **場館管理**: 內建多個羽球場館資訊

### 📊 查詢功能
- **開放活動**: `!查詢活動` - 查看目前開放報名的活動
- **報名名單**: `!查詢報名 F01` - 查看特定活動的報名名單
- **教學指令**: `!教學` - 查看所有可用指令

## 指令說明

### 活動相關指令
| 指令 | 格式 | 說明 |
|------|------|------|
| 開團 | `!週二開團` | 建立下週二的活動 |
| 開團 | `!下週三開團 20-22` | 建立下週三 20-22 的活動 |
| 開團 | `!下下週五開團 18-21 備註` | 建立下下週五 18-21 的活動 |
| 查詢活動 | `!查詢活動` | 查看目前開放報名的活動 |

### 報名相關指令
| 指令 | 格式 | 說明 |
|------|------|------|
| 報名 | `!報名 F01 小明+2 網友` | 報名 2 人 |
| 報名 | `!報名 F01 小明 晚到` | 報名 1 人（省略+1） |
| 報名 | `!報名 7/14 20-22 小明+2` | 新格式報名 |
| 修改報名 | `!修改報名 F01 小明+2 備註` | 修改報名人數或備註 |
| 取消報名 | `!取消報名 F01 小明-2` | 取消 2 人報名 |
| 取消報名 | `!取消報名 F01 小明` | 取消 1 人報名（省略-1） |
| 查詢報名 | `!查詢報名 F01` | 查看活動報名名單 |

### 管理員指令
| 指令 | 格式 | 說明 |
|------|------|------|
| 加入管理員 | `!加入管理員 @小明` | 將小明設為管理員 |
| 移除管理員 | `!移除管理員 @小明` | 移除小明的管理員權限 |
| 群組設定 | `!群組設定 場館 K01` | 設定群組預設場館 |
| 群組設定 | `!群組設定 時間 20-22` | 設定群組預設時間 |

### 其他指令
| 指令 | 格式 | 說明 |
|------|------|------|
| 教學 | `!教學` | 查看所有指令說明 |
| 場館 | `!場館` | 查看所有場館資訊 |

## 專案架構

### 目前架構 (重構後)
```
badmintonBot/
├── index.gs              # 主要入口點 (簡化)
├── webhook.gs            # LINE Webhook 處理
├── command.gs            # 指令解析與路由
├── event.gs              # 活動相關業務邏輯
├── group.gs              # 群組相關業務邏輯
├── user.gs               # 使用者相關業務邏輯
├── date.gs               # 日期處理工具
├── location.gs           # 場館查詢工具
├── sheets.gs             # Google Sheets 操作抽象層
├── constants.gs          # 所有常數與設定
└── log.gs                # 日誌記錄
```

## 設計原則

### 1. 分層架構 (Layered Architecture)
- **表現層**: `webhook.gs` - 處理外部請求，並將請求分派給指令處理層。
- **指令層**: `command.gs` - 解析使用者指令，並呼叫對應的業務邏輯。
- **業務層**: `event.gs`, `group.gs`, `user.gs` - 處理核心業務邏輯。
- **資料層**: `sheets.gs` - 封裝所有 Google Sheets 的資料存取操作。
- **工具層**: `date.gs`, `location.gs` - 提供共用的工具函式。
- **設定層**: `constants.gs` - 集中管理所有常數、API 金鑰和設定值。

### 2. 單一職責原則 (Single Responsibility Principle)
- 每個檔案專注於單一功能領域，例如 `date.gs` 只處理日期，`sheets.gs` 只處理資料存取。
- 這樣可以減少檔案間的耦合度，並提高程式碼的可讀性和可維護性。

## 技術特色

### 🔧 技術架構
- **Google Apps Script**: 雲端執行環境，無需伺服器維護
- **Google Sheets**: 資料庫，支援多人協作和版本控制
- **LINE Bot API**: 即時通訊介面
- **JavaScript ES6+**: 現代化程式語言特性

### 🛡️ 資料安全
- **群組隔離**: 每個群組的資料完全獨立，不會互相干擾
- **權限控制**: 管理員權限系統，確保資料安全
- **錯誤處理**: 完善的錯誤處理機制，避免系統崩潰

### 📈 擴展性
- **模組化設計**: 易於新增功能和維護
- **常數管理**: 集中管理設定值，便於調整
- **工具函式**: 可重用的工具函式，提高開發效率

## 重構狀態

- **[✓] 高優先級**: 已提取共用工具函數 (`date.gs`, `location.gs`)。
- **[✓] 高優先級**: 已重構資料存取層 (`sheets.gs`)。
- **[✓] 高優先級**: 已將所有常數與設定集中管理 (`constants.gs`)。
- **[✓] 中優先級**: 已將 `index.gs` 拆分，並將 Webhook 邏輯移至 `webhook.gs`。
- **[✓] 中優先級**: 已將 `command.gs`, `event.gs`, `group.gs`, `user.gs` 重構，移除重複程式碼。
- **[ ] 低優先級**: `event.gs` 中的 `updateRegistration` 和 `cancelRegistration` 仍有優化空間。

## 技術債務 (已解決)

- **[✓] `index.gs` 檔案過大**: 已拆分。
- **[✓] 日期處理邏輯重複**: 已集中到 `date.gs`。
- **[✓] 硬編碼的設定值**: 已集中到 `constants.gs`。
- **[✓] 缺乏統一的錯誤處理**: 已在各模組加入基本的錯誤處理與常數。
- **[✓] Google Sheets 操作分散**: 已集中到 `sheets.gs`。

## 部署說明

### 前置需求
1. Google 帳號
2. LINE Developer 帳號
3. Google Sheets 試算表

### 部署步驟
1. 在 Google Apps Script 中建立新專案
2. 將所有 `.gs` 檔案複製到專案中
3. 設定 LINE Bot Webhook URL
4. 設定 Google Sheets 試算表 ID
5. 部署為網路應用程式

### 環境設定
- 在 `constants.gs` 中設定 LINE Bot Channel Access Token
- 在 `constants.gs` 中設定 Google Sheets 試算表 ID
- 確保 Google Sheets 有適當的權限設定

## 貢獻指南

歡迎提交 Issue 和 Pull Request 來改善這個專案！

### 開發規範
- 遵循現有的程式碼風格
- 新增功能時請更新相關文件
- 確保所有功能都有適當的錯誤處理

## 授權

本專案採用 MIT 授權條款。
